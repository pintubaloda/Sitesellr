Sitesellr Cumulative Development Ledger (Latest)
Updated: 2026-02-18

New local package (pending push)
- Server-side validation hardening for governance/admin APIs
- DTO tightening with annotation-based validation for merchant lifecycle/onboarding, team management, invite acceptance, role templates, and backoffice/franchise inputs
- Idempotent governance migration file added: `backend-dotnet/Migrations/20260218142000_GovernanceTables.cs`
- New smoke verification checklist: `SMOKE_TEST_CHECKLIST_ADMIN.md`

Primary files changed
- backend-dotnet/Controllers/MerchantOpsController.cs
- backend-dotnet/Controllers/RoleTemplatesController.cs
- backend-dotnet/Controllers/StoreTeamController.cs
- backend-dotnet/Controllers/TeamInvitesController.cs
- backend-dotnet/Models/Audit.cs
- backend-dotnet/Migrations/20260218142000_GovernanceTables.cs
- SMOKE_TEST_CHECKLIST_ADMIN.md
- Requirestatus.txt
- github_commit.txt
- masterrequirement.docx (regenerated cumulative status)

Recent pushed baseline
- 0f4b927: governance + merchant ops + role templates + UI wiring

Update Entry: 2026-02-18 (Cumulative status format correction)
- Preserved previous details and appended main requirement matrix (Developed / Partial Developed / Need To Develop)
- Added comprehensive module-wise status mapping aligned with original Shopify-like scope
- Synced requirement artifacts format expectations for ongoing cumulative updates
- Files updated:
  - Requirestatus.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (Storefront CMS + Theme Engine)
- Added backend storefront domain models: theme catalog, store theme config, homepage layout, navigation menu, static pages
- Added Storefront APIs under `/api/stores/{storeId}/storefront/*`:
  - Theme list + apply with subscription plan gating for paid themes
  - Design settings upsert (logo/fav/header/footer/banner/tokens)
  - Homepage layout upsert (sections)
  - Navigation upsert (menu items)
  - Static pages CRUD (About/Contact/Policy/custom)
- Added platform owner theme catalog endpoints: `/api/platform/themes` (list/create)
- Added idempotent migration: `backend-dotnet/Migrations/20260218162000_StorefrontCmsThemeEngine.cs`
- Wired admin UI `/admin/store-builder` to real APIs (replaced mock theme/pages/navigation behavior)
- Added runtime seed for initial theme catalog if empty
- Files updated:
  - backend-dotnet/Models/Storefront.cs
  - backend-dotnet/Data/AppDbContext.cs
  - backend-dotnet/Controllers/StorefrontController.cs
  - backend-dotnet/Migrations/20260218162000_StorefrontCmsThemeEngine.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/admin/StoreBuilder.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (Store Builder & Customization Expansion)
- Added public storefront runtime API/controller: `backend-dotnet/Controllers/PublicStorefrontController.cs`
- Added media upload + media asset listing APIs in storefront module (`/storefront/media/upload`, `/storefront/media`)
- Added B2B visibility settings on storefront config (`ShowPricing`, `LoginToViewPrice`, `CatalogMode`, `CatalogVisibilityJson`)
- Added media asset entity + DB mapping (`StoreMediaAsset`) and migration `20260218170000_StorefrontPublicB2BMedia.cs`
- Enabled static file serving for uploaded assets in backend runtime
- Added platform theme management UI page `/admin/platform-themes`
- Added public storefront frontend runtime page `/s/:subdomain/*`
- Upgraded Store Builder UI with:
  - section reorder + widget settings editor
  - B2B visibility controls
  - logo/favicon file upload wiring
- Files updated:
  - backend-dotnet/Controllers/PublicStorefrontController.cs
  - backend-dotnet/Controllers/StorefrontController.cs
  - backend-dotnet/Models/Storefront.cs
  - backend-dotnet/Data/AppDbContext.cs
  - backend-dotnet/Migrations/20260218170000_StorefrontPublicB2BMedia.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/storefront/StorefrontPublic.js
  - frontend/src/pages/admin/PlatformThemes.js
  - frontend/src/pages/admin/StoreBuilder.js
  - frontend/src/App.js
  - frontend/src/components/layouts/DashboardLayout.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (Custom Domain + Free SSL utility)
- Added domain SSL model and persistence: `StoreDomain`
- Added SSL provider abstraction + free SSL shell provider:
  - `backend-dotnet/Services/SslService.cs`
  - `ISslProvider`, `ISslProviderFactory`, `LetsEncryptShellProvider`
- Added store domain/SSL APIs:
  - `GET/POST /api/stores/{storeId}/domains`
  - `POST /api/stores/{storeId}/domains/{domainId}/verify`
  - `POST /api/stores/{storeId}/domains/{domainId}/issue-ssl`
- Added admin UI for domain + SSL operations: `/admin/domains-ssl`
- Added migration: `backend-dotnet/Migrations/20260218175500_StoreDomainsFreeSsl.cs`
- Runtime startup SQL updated for `store_domains` table/indexes
- Note: actual Let's Encrypt issuance is command-driven and requires infra env setup:
  - `SSL_ISSUER_COMMAND` (example acme/certbot command template with `{domain}` `{email}`)
  - `SSL_CONTACT_EMAIL`
- Files updated:
  - backend-dotnet/Models/Storefront.cs
  - backend-dotnet/Data/AppDbContext.cs
  - backend-dotnet/Services/SslService.cs
  - backend-dotnet/Controllers/DomainSslController.cs
  - backend-dotnet/Migrations/20260218175500_StoreDomainsFreeSsl.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/admin/DomainsSsl.js
  - frontend/src/App.js
  - frontend/src/components/layouts/DashboardLayout.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Fix Entry: 2026-02-18 (CI compile fix for commit a11d081)
- Fixed invalid escape usage in migration `backend-dotnet/Migrations/20260218162000_StorefrontCmsThemeEngine.cs`
- Replaced `\"` with doubled quotes `""` inside verbatim SQL strings to resolve C# compile errors (newline in constant / unexpected '\\')

Fix Entry: 2026-02-18 (CI compile fix for commit 6d36a56)
- Fixed verbatim SQL escaping in `backend-dotnet/Migrations/20260218170000_StorefrontPublicB2BMedia.cs`
- Replaced `\"` with `""` in SQL string block to remove C# parser errors

Fix Entry: 2026-02-18 (CI compile fix for commit bcb555e)
- Fixed verbatim SQL escaping in `backend-dotnet/Migrations/20260218175500_StoreDomainsFreeSsl.cs`
- Replaced `\"` with `""` in SQL blocks (store_domains + store_media_assets)

Update Entry: 2026-02-18 (Cloudflare subdomain + automatic custom-domain SSL flow)
- Added Cloudflare DNS service and auto tenant subdomain provisioning:
  - `backend-dotnet/Services/CloudflareDnsService.cs`
  - `StoresController` now calls Cloudflare provisioning on create/update when subdomain exists
- Added automatic custom-domain verification+SSL attempt on add:
  - `DomainSslController` now auto-checks DNS, marks verified when resolvable, and triggers SSL issuance automatically
  - Fallback remains available via `Verify Now` and `Issue SSL` actions
- Registered Cloudflare DNS service in runtime DI (`Program.cs`)
- Updated domain UI wording/button for fallback flow (`Verify Now`)
- Files updated:
  - backend-dotnet/Services/CloudflareDnsService.cs
  - backend-dotnet/Controllers/StoresController.cs
  - backend-dotnet/Controllers/DomainSslController.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/admin/DomainsSsl.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (Visual canvas foundation: validation + versions + undo/redo)
- Backend storefront layout versioning and validator:
  - Added `StorefrontLayoutVersion` model and DB mapping
  - Added migration: `backend-dotnet/Migrations/20260218190000_StorefrontLayoutVersions.cs`
  - Added APIs in `StorefrontController`:
    - `POST /homepage-layout/validate`
    - `GET /homepage-layout/versions`
    - `POST /homepage-layout/publish`
    - `POST /homepage-layout/rollback`
  - `PUT /homepage-layout` now validates schema and stores draft versions
- Program startup SQL includes `storefront_layout_versions` table/index safety creation
- Store Builder UI enhancements:
  - undo/redo timeline
  - section tree with nested child blocks
  - version list with publish/rollback actions
  - preview rendering includes nested blocks
- Files updated:
  - backend-dotnet/Models/Storefront.cs
  - backend-dotnet/Data/AppDbContext.cs
  - backend-dotnet/Controllers/StorefrontController.cs
  - backend-dotnet/Migrations/20260218190000_StorefrontLayoutVersions.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/admin/StoreBuilder.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (WYSIWYG deep nested canvas iteration)
- Enhanced Store Builder canvas with recursive render and deep nested drag targets
- Added node identity normalization (`id`) and tree-based reparent drag/drop flow
- Added advanced inspector panel fields for node style/settings and JSON editor
- Added deeper undo/redo snapshot handling for tree edits
- Files updated:
  - frontend/src/pages/admin/StoreBuilder.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (Canvas UX: before/after zones + grid/absolute + timeline)
- Store Builder canvas upgraded with sibling drop zones (before/after) and recursive nested drop handling
- Added absolute/freeform canvas mode with grid snapping (8px) and inspector position controls (x/y/w)
- Added timeline playback panel using editor history snapshots with node-count delta insight
- Files updated:
  - frontend/src/pages/admin/StoreBuilder.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (Collaboration session + diff foundation)
- Added `StorefrontEditSession` model and DB mapping for collaborative editor heartbeat
- Added migration: `backend-dotnet/Migrations/20260218194000_StorefrontCollaborationSessions.cs`
- Added Storefront collaboration endpoints:
  - `GET /collaboration/sessions`
  - `POST /collaboration/sessions`
  - `DELETE /collaboration/sessions/me`
- Added Storefront version diff endpoint:
  - `GET /homepage-layout/diff?fromVersionId=&toVersionId=`
- Store Builder frontend now includes:
  - collaboration panel with editor heartbeat/presence list
  - diff request action and summary
- Files updated:
  - backend-dotnet/Models/Storefront.cs
  - backend-dotnet/Data/AppDbContext.cs
  - backend-dotnet/Controllers/StorefrontController.cs
  - backend-dotnet/Migrations/20260218194000_StorefrontCollaborationSessions.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/admin/StoreBuilder.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (Realtime websocket + OT-like merge + live cursor)
- Added backend realtime collaboration service:
  - `backend-dotnet/Services/StorefrontRealtimeService.cs`
  - room-based websocket handling, snapshot, presence, op apply, conflict responses
- Added websocket endpoint wiring in runtime:
  - `/ws/storefront/{storeId}` in `backend-dotnet/Program.cs`
- Added collaboration data model + APIs foundation already used by builder sessions/diff
- Store Builder frontend now:
  - opens websocket connection per store
  - sends/receives realtime ops with revision guard
  - resolves conflicts via server snapshot
  - sends node-focused cursor events and shows remote cursor indicators
- Files updated:
  - backend-dotnet/Services/StorefrontRealtimeService.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/admin/StoreBuilder.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Fix Entry: 2026-02-18 (CI fix for commit 114c23e)
- Fixed websocket send compile issue in `backend-dotnet/Services/StorefrontRealtimeService.cs` by removing invalid `.AsTask()` calls where `SendAsync` already returns `Task`
- Fixed warning in `backend-dotnet/Services/TenancyContext.cs` by removing unused variable `storeIdStr`

Update Entry: 2026-02-18 (B2B customer-group visibility engine)
- Added new models:
  - `CustomerGroup`, `CustomerGroupMember`, `VisibilityRule`
- Added B2B admin APIs:
  - `GET/POST /api/stores/{storeId}/b2b/groups`
  - `POST /api/stores/{storeId}/b2b/groups/{groupId}/members/{customerId}`
  - `GET/POST/DELETE /api/stores/{storeId}/b2b/rules*`
- Added public storefront enforcement by visibility rules:
  - products/pages/theme blocks filtered by group/all-group allow/deny rules
  - `customerGroupId` query parameter for preview-as-group behavior
- Added migration:
  - `backend-dotnet/Migrations/20260218202000_B2bCustomerGroupVisibility.cs`
- Added startup SQL safety for new B2B tables/indexes in Program.cs
- Wired Store Builder UI for B2B groups/rules and basic preview-as-group controls
- Files updated:
  - backend-dotnet/Models/B2bVisibility.cs
  - backend-dotnet/Data/AppDbContext.cs
  - backend-dotnet/Controllers/B2bVisibilityController.cs
  - backend-dotnet/Controllers/PublicStorefrontController.cs
  - backend-dotnet/Migrations/20260218202000_B2bCustomerGroupVisibility.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/admin/StoreBuilder.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (CORS registration fix + role test user seed)
- Updated CORS policy behavior in `Program.cs`:
  - explicit origins now use `AllowCredentials()`
  - wildcard remains non-credential mode (browser-compatible behavior)
- Added optional test-user role seeding flow in `Program.cs` (guarded by env):
  - `SEED_TEST_USERS=true`
  - `TEST_USER_PASSWORD` configurable
  - seeds platform owner/staff and store owner/admin/staff users + demo merchant/store and role assignments
- Files updated:
  - backend-dotnet/Program.cs
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Fix Entry: 2026-02-18 (seeded login credentials reliability)
- Updated test-user seeding in `Program.cs` to always reset seeded users to known password and unlocked state
- Prevents pre-existing locked/random-password accounts (e.g., from `PLATFORM_OWNER_EMAIL` seed path) from breaking test credentials

Update Entry: 2026-02-18 (default seeded password update)
- Updated fallback test seed password in `Program.cs` to `9414064554`
- Effective when `SEED_TEST_USERS=true` and `TEST_USER_PASSWORD` env is not set

Fix Entry: 2026-02-18 (csrf_invalid on login/register)
- Updated `backend-dotnet/Security/CsrfMiddleware.cs`
- Added CSRF-exempt path list for authentication bootstrap endpoints to avoid blocking first unauthenticated token exchange

Update Entry: 2026-02-18 (role-based UI visibility split)
- Added backend endpoint: `GET /api/auth/access` (`AuthAccessController`) to expose effective platform/store access context
- Updated dashboard sidebar rendering to be role-aware via dynamic scope filtering
  - platform-owner only menus
  - platform-staff menus
  - store-scoped menus
- Files updated:
  - backend-dotnet/Controllers/AuthAccessController.cs
  - frontend/src/components/layouts/DashboardLayout.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

[Pending Commit] 2026-02-18 19:16 IST
Title: Platform owner governance hardening + sensitive action controls + role-aware menu refinement
Files:
- backend-dotnet/Security/PermissionCatalog.cs
- backend-dotnet/Security/Rbac.cs
- backend-dotnet/Program.cs
- backend-dotnet/Services/TenancyContext.cs
- backend-dotnet/Controllers/AuthAccessController.cs
- backend-dotnet/Controllers/PlatformRbacController.cs
- backend-dotnet/Controllers/MerchantOpsController.cs
- frontend/src/components/layouts/DashboardLayout.js
- frontend/src/pages/admin/PlatformRbac.js
Notes:
- Added explicit super-admin permission matrix and policy registrations.
- Added reason + optional step-up enforcement for sensitive RBAC and lifecycle actions.
- Added access introspection payload for platform permissions/high-risk actions.
- Updated UI to pass reason and step-up headers and to avoid showing store-only menus to platform owner by default.
[Committed] db9fff8 pushed to origin/main
[Committed] db9fff8 pushed to origin/main
