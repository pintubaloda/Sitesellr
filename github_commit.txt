Sitesellr Cumulative Development Ledger (Latest)
Updated: 2026-02-18

New local package (pending push)
- Server-side validation hardening for governance/admin APIs
- DTO tightening with annotation-based validation for merchant lifecycle/onboarding, team management, invite acceptance, role templates, and backoffice/franchise inputs
- Idempotent governance migration file added: `backend-dotnet/Migrations/20260218142000_GovernanceTables.cs`
- New smoke verification checklist: `SMOKE_TEST_CHECKLIST_ADMIN.md`

Primary files changed
- backend-dotnet/Controllers/MerchantOpsController.cs
- backend-dotnet/Controllers/RoleTemplatesController.cs
- backend-dotnet/Controllers/StoreTeamController.cs
- backend-dotnet/Controllers/TeamInvitesController.cs
- backend-dotnet/Models/Audit.cs
- backend-dotnet/Migrations/20260218142000_GovernanceTables.cs
- SMOKE_TEST_CHECKLIST_ADMIN.md
- Requirestatus.txt
- github_commit.txt
- masterrequirement.docx (regenerated cumulative status)

Recent pushed baseline
- 0f4b927: governance + merchant ops + role templates + UI wiring

Update Entry: 2026-02-18 (Cumulative status format correction)
- Preserved previous details and appended main requirement matrix (Developed / Partial Developed / Need To Develop)
- Added comprehensive module-wise status mapping aligned with original Shopify-like scope
- Synced requirement artifacts format expectations for ongoing cumulative updates
- Files updated:
  - Requirestatus.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (Storefront CMS + Theme Engine)
- Added backend storefront domain models: theme catalog, store theme config, homepage layout, navigation menu, static pages
- Added Storefront APIs under `/api/stores/{storeId}/storefront/*`:
  - Theme list + apply with subscription plan gating for paid themes
  - Design settings upsert (logo/fav/header/footer/banner/tokens)
  - Homepage layout upsert (sections)
  - Navigation upsert (menu items)
  - Static pages CRUD (About/Contact/Policy/custom)
- Added platform owner theme catalog endpoints: `/api/platform/themes` (list/create)
- Added idempotent migration: `backend-dotnet/Migrations/20260218162000_StorefrontCmsThemeEngine.cs`
- Wired admin UI `/admin/store-builder` to real APIs (replaced mock theme/pages/navigation behavior)
- Added runtime seed for initial theme catalog if empty
- Files updated:
  - backend-dotnet/Models/Storefront.cs
  - backend-dotnet/Data/AppDbContext.cs
  - backend-dotnet/Controllers/StorefrontController.cs
  - backend-dotnet/Migrations/20260218162000_StorefrontCmsThemeEngine.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/admin/StoreBuilder.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (Store Builder & Customization Expansion)
- Added public storefront runtime API/controller: `backend-dotnet/Controllers/PublicStorefrontController.cs`
- Added media upload + media asset listing APIs in storefront module (`/storefront/media/upload`, `/storefront/media`)
- Added B2B visibility settings on storefront config (`ShowPricing`, `LoginToViewPrice`, `CatalogMode`, `CatalogVisibilityJson`)
- Added media asset entity + DB mapping (`StoreMediaAsset`) and migration `20260218170000_StorefrontPublicB2BMedia.cs`
- Enabled static file serving for uploaded assets in backend runtime
- Added platform theme management UI page `/admin/platform-themes`
- Added public storefront frontend runtime page `/s/:subdomain/*`
- Upgraded Store Builder UI with:
  - section reorder + widget settings editor
  - B2B visibility controls
  - logo/favicon file upload wiring
- Files updated:
  - backend-dotnet/Controllers/PublicStorefrontController.cs
  - backend-dotnet/Controllers/StorefrontController.cs
  - backend-dotnet/Models/Storefront.cs
  - backend-dotnet/Data/AppDbContext.cs
  - backend-dotnet/Migrations/20260218170000_StorefrontPublicB2BMedia.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/storefront/StorefrontPublic.js
  - frontend/src/pages/admin/PlatformThemes.js
  - frontend/src/pages/admin/StoreBuilder.js
  - frontend/src/App.js
  - frontend/src/components/layouts/DashboardLayout.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (Custom Domain + Free SSL utility)
- Added domain SSL model and persistence: `StoreDomain`
- Added SSL provider abstraction + free SSL shell provider:
  - `backend-dotnet/Services/SslService.cs`
  - `ISslProvider`, `ISslProviderFactory`, `LetsEncryptShellProvider`
- Added store domain/SSL APIs:
  - `GET/POST /api/stores/{storeId}/domains`
  - `POST /api/stores/{storeId}/domains/{domainId}/verify`
  - `POST /api/stores/{storeId}/domains/{domainId}/issue-ssl`
- Added admin UI for domain + SSL operations: `/admin/domains-ssl`
- Added migration: `backend-dotnet/Migrations/20260218175500_StoreDomainsFreeSsl.cs`
- Runtime startup SQL updated for `store_domains` table/indexes
- Note: actual Let's Encrypt issuance is command-driven and requires infra env setup:
  - `SSL_ISSUER_COMMAND` (example acme/certbot command template with `{domain}` `{email}`)
  - `SSL_CONTACT_EMAIL`
- Files updated:
  - backend-dotnet/Models/Storefront.cs
  - backend-dotnet/Data/AppDbContext.cs
  - backend-dotnet/Services/SslService.cs
  - backend-dotnet/Controllers/DomainSslController.cs
  - backend-dotnet/Migrations/20260218175500_StoreDomainsFreeSsl.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/admin/DomainsSsl.js
  - frontend/src/App.js
  - frontend/src/components/layouts/DashboardLayout.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Fix Entry: 2026-02-18 (CI compile fix for commit a11d081)
- Fixed invalid escape usage in migration `backend-dotnet/Migrations/20260218162000_StorefrontCmsThemeEngine.cs`
- Replaced `\"` with doubled quotes `""` inside verbatim SQL strings to resolve C# compile errors (newline in constant / unexpected '\\')

Fix Entry: 2026-02-18 (CI compile fix for commit 6d36a56)
- Fixed verbatim SQL escaping in `backend-dotnet/Migrations/20260218170000_StorefrontPublicB2BMedia.cs`
- Replaced `\"` with `""` in SQL string block to remove C# parser errors

Fix Entry: 2026-02-18 (CI compile fix for commit bcb555e)
- Fixed verbatim SQL escaping in `backend-dotnet/Migrations/20260218175500_StoreDomainsFreeSsl.cs`
- Replaced `\"` with `""` in SQL blocks (store_domains + store_media_assets)

Update Entry: 2026-02-18 (Cloudflare subdomain + automatic custom-domain SSL flow)
- Added Cloudflare DNS service and auto tenant subdomain provisioning:
  - `backend-dotnet/Services/CloudflareDnsService.cs`
  - `StoresController` now calls Cloudflare provisioning on create/update when subdomain exists
- Added automatic custom-domain verification+SSL attempt on add:
  - `DomainSslController` now auto-checks DNS, marks verified when resolvable, and triggers SSL issuance automatically
  - Fallback remains available via `Verify Now` and `Issue SSL` actions
- Registered Cloudflare DNS service in runtime DI (`Program.cs`)
- Updated domain UI wording/button for fallback flow (`Verify Now`)
- Files updated:
  - backend-dotnet/Services/CloudflareDnsService.cs
  - backend-dotnet/Controllers/StoresController.cs
  - backend-dotnet/Controllers/DomainSslController.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/admin/DomainsSsl.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (Visual canvas foundation: validation + versions + undo/redo)
- Backend storefront layout versioning and validator:
  - Added `StorefrontLayoutVersion` model and DB mapping
  - Added migration: `backend-dotnet/Migrations/20260218190000_StorefrontLayoutVersions.cs`
  - Added APIs in `StorefrontController`:
    - `POST /homepage-layout/validate`
    - `GET /homepage-layout/versions`
    - `POST /homepage-layout/publish`
    - `POST /homepage-layout/rollback`
  - `PUT /homepage-layout` now validates schema and stores draft versions
- Program startup SQL includes `storefront_layout_versions` table/index safety creation
- Store Builder UI enhancements:
  - undo/redo timeline
  - section tree with nested child blocks
  - version list with publish/rollback actions
  - preview rendering includes nested blocks
- Files updated:
  - backend-dotnet/Models/Storefront.cs
  - backend-dotnet/Data/AppDbContext.cs
  - backend-dotnet/Controllers/StorefrontController.cs
  - backend-dotnet/Migrations/20260218190000_StorefrontLayoutVersions.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/admin/StoreBuilder.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (WYSIWYG deep nested canvas iteration)
- Enhanced Store Builder canvas with recursive render and deep nested drag targets
- Added node identity normalization (`id`) and tree-based reparent drag/drop flow
- Added advanced inspector panel fields for node style/settings and JSON editor
- Added deeper undo/redo snapshot handling for tree edits
- Files updated:
  - frontend/src/pages/admin/StoreBuilder.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (Canvas UX: before/after zones + grid/absolute + timeline)
- Store Builder canvas upgraded with sibling drop zones (before/after) and recursive nested drop handling
- Added absolute/freeform canvas mode with grid snapping (8px) and inspector position controls (x/y/w)
- Added timeline playback panel using editor history snapshots with node-count delta insight
- Files updated:
  - frontend/src/pages/admin/StoreBuilder.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (Collaboration session + diff foundation)
- Added `StorefrontEditSession` model and DB mapping for collaborative editor heartbeat
- Added migration: `backend-dotnet/Migrations/20260218194000_StorefrontCollaborationSessions.cs`
- Added Storefront collaboration endpoints:
  - `GET /collaboration/sessions`
  - `POST /collaboration/sessions`
  - `DELETE /collaboration/sessions/me`
- Added Storefront version diff endpoint:
  - `GET /homepage-layout/diff?fromVersionId=&toVersionId=`
- Store Builder frontend now includes:
  - collaboration panel with editor heartbeat/presence list
  - diff request action and summary
- Files updated:
  - backend-dotnet/Models/Storefront.cs
  - backend-dotnet/Data/AppDbContext.cs
  - backend-dotnet/Controllers/StorefrontController.cs
  - backend-dotnet/Migrations/20260218194000_StorefrontCollaborationSessions.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/admin/StoreBuilder.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (Realtime websocket + OT-like merge + live cursor)
- Added backend realtime collaboration service:
  - `backend-dotnet/Services/StorefrontRealtimeService.cs`
  - room-based websocket handling, snapshot, presence, op apply, conflict responses
- Added websocket endpoint wiring in runtime:
  - `/ws/storefront/{storeId}` in `backend-dotnet/Program.cs`
- Added collaboration data model + APIs foundation already used by builder sessions/diff
- Store Builder frontend now:
  - opens websocket connection per store
  - sends/receives realtime ops with revision guard
  - resolves conflicts via server snapshot
  - sends node-focused cursor events and shows remote cursor indicators
- Files updated:
  - backend-dotnet/Services/StorefrontRealtimeService.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/admin/StoreBuilder.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Fix Entry: 2026-02-18 (CI fix for commit 114c23e)
- Fixed websocket send compile issue in `backend-dotnet/Services/StorefrontRealtimeService.cs` by removing invalid `.AsTask()` calls where `SendAsync` already returns `Task`
- Fixed warning in `backend-dotnet/Services/TenancyContext.cs` by removing unused variable `storeIdStr`

Update Entry: 2026-02-18 (B2B customer-group visibility engine)
- Added new models:
  - `CustomerGroup`, `CustomerGroupMember`, `VisibilityRule`
- Added B2B admin APIs:
  - `GET/POST /api/stores/{storeId}/b2b/groups`
  - `POST /api/stores/{storeId}/b2b/groups/{groupId}/members/{customerId}`
  - `GET/POST/DELETE /api/stores/{storeId}/b2b/rules*`
- Added public storefront enforcement by visibility rules:
  - products/pages/theme blocks filtered by group/all-group allow/deny rules
  - `customerGroupId` query parameter for preview-as-group behavior
- Added migration:
  - `backend-dotnet/Migrations/20260218202000_B2bCustomerGroupVisibility.cs`
- Added startup SQL safety for new B2B tables/indexes in Program.cs
- Wired Store Builder UI for B2B groups/rules and basic preview-as-group controls
- Files updated:
  - backend-dotnet/Models/B2bVisibility.cs
  - backend-dotnet/Data/AppDbContext.cs
  - backend-dotnet/Controllers/B2bVisibilityController.cs
  - backend-dotnet/Controllers/PublicStorefrontController.cs
  - backend-dotnet/Migrations/20260218202000_B2bCustomerGroupVisibility.cs
  - backend-dotnet/Program.cs
  - frontend/src/pages/admin/StoreBuilder.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Update Entry: 2026-02-18 (CORS registration fix + role test user seed)
- Updated CORS policy behavior in `Program.cs`:
  - explicit origins now use `AllowCredentials()`
  - wildcard remains non-credential mode (browser-compatible behavior)
- Added optional test-user role seeding flow in `Program.cs` (guarded by env):
  - `SEED_TEST_USERS=true`
  - `TEST_USER_PASSWORD` configurable
  - seeds platform owner/staff and store owner/admin/staff users + demo merchant/store and role assignments
- Files updated:
  - backend-dotnet/Program.cs
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

Fix Entry: 2026-02-18 (seeded login credentials reliability)
- Updated test-user seeding in `Program.cs` to always reset seeded users to known password and unlocked state
- Prevents pre-existing locked/random-password accounts (e.g., from `PLATFORM_OWNER_EMAIL` seed path) from breaking test credentials

Update Entry: 2026-02-18 (default seeded password update)
- Updated fallback test seed password in `Program.cs` to `9414064554`
- Effective when `SEED_TEST_USERS=true` and `TEST_USER_PASSWORD` env is not set

Fix Entry: 2026-02-18 (csrf_invalid on login/register)
- Updated `backend-dotnet/Security/CsrfMiddleware.cs`
- Added CSRF-exempt path list for authentication bootstrap endpoints to avoid blocking first unauthenticated token exchange

Update Entry: 2026-02-18 (role-based UI visibility split)
- Added backend endpoint: `GET /api/auth/access` (`AuthAccessController`) to expose effective platform/store access context
- Updated dashboard sidebar rendering to be role-aware via dynamic scope filtering
  - platform-owner only menus
  - platform-staff menus
  - store-scoped menus
- Files updated:
  - backend-dotnet/Controllers/AuthAccessController.cs
  - frontend/src/components/layouts/DashboardLayout.js
  - Requirestatus.txt
  - github_commit.txt
  - masterrequirement.txt
  - masterrequirement.docx

[Pending Commit] 2026-02-18 19:16 IST
Title: Platform owner governance hardening + sensitive action controls + role-aware menu refinement
Files:
- backend-dotnet/Security/PermissionCatalog.cs
- backend-dotnet/Security/Rbac.cs
- backend-dotnet/Program.cs
- backend-dotnet/Services/TenancyContext.cs
- backend-dotnet/Controllers/AuthAccessController.cs
- backend-dotnet/Controllers/PlatformRbacController.cs
- backend-dotnet/Controllers/MerchantOpsController.cs
- frontend/src/components/layouts/DashboardLayout.js
- frontend/src/pages/admin/PlatformRbac.js
Notes:
- Added explicit super-admin permission matrix and policy registrations.
- Added reason + optional step-up enforcement for sensitive RBAC and lifecycle actions.
- Added access introspection payload for platform permissions/high-risk actions.
- Updated UI to pass reason and step-up headers and to avoid showing store-only menus to platform owner by default.
[Committed] db9fff8 pushed to origin/main
[Committed] db9fff8 pushed to origin/main

[Pending Commit] 2026-02-19 08:48 IST
Title: Expand storefront theme marketplace with 10 category themes and selection filters
Files:
- backend-dotnet/Program.cs
- frontend/src/pages/admin/StoreBuilder.js
Notes:
- Added category-wise free/paid theme catalog seed data and idempotent slug-based insert logic.
- Added storefront builder category dropdown + search + filtered grid for theme selection UX.
[Committed] 7c5636b pushed to origin/main
[Committed] 7c5636b pushed to origin/main

[Pending Commit] 2026-02-19 08:52 IST
Title: Implement platform-owner theme lifecycle management (publish/pricing/plan mapping/featured rank)
Files:
- backend-dotnet/Models/Storefront.cs
- backend-dotnet/Data/AppDbContext.cs
- backend-dotnet/Program.cs
- backend-dotnet/Controllers/StorefrontController.cs
- frontend/src/pages/admin/PlatformThemes.js
Notes:
- Added full platform theme lifecycle endpoints and UI controls for publish/unpublish, pricing, plan codes, and featured rank.
[Committed] 8aaf2e6 pushed to origin/main
[Committed] 8aaf2e6 pushed to origin/main

[Pending Commit] 2026-02-19 09:11 IST
Title: Add nested storefront navigation editor, premium section marketplace, wholesale MOQ/quote messaging
Files:
- frontend/src/pages/admin/StoreBuilder.js
- frontend/src/pages/storefront/StorefrontPublic.js
Notes:
- Added nested menu management in builder + recursive menu rendering on public storefront.
- Added premium/free section marketplace shortcuts.
- Added wholesale messaging UX (MOQ + Request Quote CTA) based on catalog mode.
[Committed] cf5f165 pushed to origin/main

[Pending Commit] 2026-02-19 09:19 IST
Title: Enforce premium section entitlements, add menu visibility rules, and implement quote inquiry workflow
Files:
- backend-dotnet/Models/Storefront.cs
- backend-dotnet/Data/AppDbContext.cs
- backend-dotnet/Program.cs
- backend-dotnet/Controllers/StorefrontController.cs
- backend-dotnet/Controllers/PublicStorefrontController.cs
- frontend/src/pages/admin/StoreBuilder.js
- frontend/src/pages/storefront/StorefrontPublic.js
Notes:
- Added backend + frontend implementation for all 3 requested items in this scope.
[Committed] 68bfb62 pushed to origin/main
[Committed] 68bfb62 pushed to origin/main

[Pending Commit] 2026-02-19 09:26 IST
Title: Add menu DnD tree operations, advanced boolean visibility evaluation, and quote assignment/SLA automation
Files:
- backend-dotnet/Services/EmailService.cs
- backend-dotnet/Models/Storefront.cs
- backend-dotnet/Data/AppDbContext.cs
- backend-dotnet/Program.cs
- backend-dotnet/Controllers/StorefrontController.cs
- backend-dotnet/Controllers/PublicStorefrontController.cs
- frontend/src/pages/admin/StoreBuilder.js
- frontend/src/pages/storefront/StorefrontPublic.js
Notes:
- Implemented requested scope with API + UI + notification hooks.
[Committed] e52bf32 pushed to origin/main

[Pending Commit] 2026-02-19 09:34 IST
Title: Add branding presets, richer storefront browse/checkout UX, runtime theme scaffolding, and preview mode
Files:
- backend-dotnet/Models/Storefront.cs
- backend-dotnet/Data/AppDbContext.cs
- backend-dotnet/Program.cs
- backend-dotnet/Controllers/StorefrontController.cs
- backend-dotnet/Controllers/PublicStorefrontController.cs
- frontend/src/pages/admin/StoreBuilder.js
- frontend/src/pages/admin/PlatformThemes.js
- frontend/src/pages/storefront/StorefrontPublic.js
Notes:
- Covers requested items 1-7 with full implementation where feasible and schema-level foundations for runtime theme packs.
[Committed] 75afd72 pushed to origin/main

[Pending Commit] 2026-02-19 09:38 IST
Title: Fix StorefrontController out-parameter capture compile error
Files:
- backend-dotnet/Controllers/StorefrontController.cs
Notes:
- Prevented use of `out blockedKey` inside local function by introducing `foundBlockedKey` and delayed assignment.
[Committed] 2388fad pushed to origin/main

[Pending Commit] 2026-02-19 09:43 IST
Title: Hotfix Render startup crash caused by ExecuteSqlRaw format braces
Files:
- backend-dotnet/Program.cs
Notes:
- Fixes `System.FormatException` at Program.cs line 296 on Render deployment.
[Committed] 52ea961 pushed to origin/main

[Pending Commit] 2026-02-19 10:01 IST
Title: Reduce env/role coupling and improve storefront UX maturity
Files:
- backend-dotnet/Models/Storefront.cs
- backend-dotnet/Data/AppDbContext.cs
- backend-dotnet/Program.cs
- backend-dotnet/Controllers/StorefrontController.cs
- backend-dotnet/Controllers/PublicStorefrontController.cs
- frontend/src/pages/admin/StoreBuilder.js
- frontend/src/pages/storefront/StorefrontPublic.js
Notes:
- Added store-level quote alert settings, owner bootstrap password support, visual menu condition builder, and checkout payment callback API.
[Committed] d09349a pushed to origin/main

[Pending Commit] 2026-02-19 10:18 IST
Title: Align permission catalog to requested model and bind seeded test users by role bundles
Files:
- backend-dotnet/Security/PermissionCatalog.cs
- backend-dotnet/Services/TenancyContext.cs
- backend-dotnet/Program.cs
Notes:
- Adds broader atomic permission set and runtime role-bundle permission mapping.
- Seeds explicit store permissions for test users (owner/admin/staff) to match their role bundles.
[Committed] f490627 pushed to origin/main

[Pending Commit] 2026-02-19 10:27 IST
Title: Add auth permissions debug endpoint
Files:
- backend-dotnet/Controllers/AuthAccessController.cs
Notes:
- New endpoint: `/api/auth/permissions`.
[Committed] d77fa77 pushed to origin/main

[Pending Commit] 2026-02-19 10:43 IST
Title: Enforce strict frontend menu gating from /api/auth/permissions
Files:
- frontend/src/components/layouts/DashboardLayout.js
Notes:
- Menu visibility now permission-by-permission for every sidebar item.
[Committed] 32a1438 pushed to origin/main

[2026-02-20] Pending Commit (local)
- Scope: Professional storefront theme runtime upgrade (header/menu/footer/cart/checkout/login/PDP/PLP)
- Files changed:
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/pages/storefront/StorefrontPublic.js
- Notes:
  - Build not executed successfully in local sandbox because frontend dependencies are missing (`craco: command not found`).

[2026-02-20] Pending Commit (local)
- Scope: Theme variant engine + campaign template billing orchestration + storefront customer auth/session
- Backend changed:
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Models/Storefront.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Data/AppDbContext.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Controllers/StorefrontController.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Controllers/PublicStorefrontController.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Program.cs
- Frontend changed:
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/pages/storefront/StorefrontPublic.js
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/pages/admin/StoreBuilder.js
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/pages/admin/PlatformThemes.js
- Verification note:
  - Local backend build not executable in current shell (`dotnet` missing).

[2026-02-20] Pending Commit (local)
- Scope: Pending-set closure pass (theme variant depth, auth hardening, campaign billing hardening, editor playback polish)
- Backend:
  - Added campaign payment event model and billing lifecycle endpoints (callback/refund/chargeback).
  - Added customer auth hardening APIs (verify email, forgot/reset password, MFA challenge, session list/revoke).
  - Added theme PLP/PDP variant metadata persistence and exposure.
  - Added startup SQL safety for new tables/columns in migration-on-startup flow.
- Frontend:
  - Storefront login security tools UI wired (verify, reset, session controls).
  - Runtime package sanitized allowlist isolation.
  - Store builder timeline replay controls enhanced.
- Smoke tests:
  - Updated admin smoke checklist for newly added flows.

[2026-02-20] Pending Commit (hotfix)
- Fix CS0833 in StorefrontController campaign payment callback response anonymous type.
- File: /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Controllers/StorefrontController.cs

[2026-02-20] Pending Commit
- Theme system hardening for SaaS-safe ecommerce contract:
  - Added ThemeContractService validation.
  - Added mandatory template/hook/schema/version fields on theme model.
  - Enforced contract in platform theme lifecycle APIs.
  - Updated startup SQL alters for new theme contract columns.
  - Updated platform theme admin UI to manage contract JSON.

[2026-02-20] Pending Commit (build fix)
- Fixed Program.cs invalid escaping in SQL default JSON literals causing Docker publish compile errors.
- File: /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Program.cs

[2026-02-20] Pending Commit
- Feature: Platform-owner ZIP upload and auto-import for external theme packages.
- Backend: `/api/platform/themes/import-zip` with manifest parse + contract validation + asset extraction.
- Frontend: Platform Themes upload panel (`Upload & Import`).
- Spec file: `THEME_ZIP_SPEC.md`.

[2026-02-20] Pending Commit
- Subscription capability system implementation:
  - expanded BillingPlan capability fields + StoreUsageCounter model
  - subscription capability service and server-side enforcement hooks
  - new subscription and platform billing plan APIs
  - onboarding plan capability output
  - default plan capability seeding

[2026-02-20] Pending Commit
- Added platform global branding module with DB settings table + API + admin UI and landing/admin runtime application.

[2026-02-20] Pending Commit
- Product/order hardening:
  - variant reserved quantity + reservation/release endpoints + atomic deduction in checkout
  - categories API with plan limit enforcement
  - product CSV import async jobs + row validation report
  - public storefront caching
  - load/smoke artifacts and backend-ui wiring status sheet

[2026-02-20] Pending Commit
- Frontend UI wiring in one pass:
  - Products admin CSV import + async job monitor + inline error list.
  - Storefront cart/checkout stock reserve/release integration.
- Files:
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/pages/admin/Products.js
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/pages/storefront/StorefrontPublic.js

[2026-02-20] Pending Commit
- Platform RBAC category-based assignment UX:
  - Added side user menu with `Platform Users` and `Store Users` categories.
  - Added backend user/store listing endpoints for assignment workflows.
- Files:
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Controllers/PlatformRbacController.cs
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/pages/admin/PlatformRbac.js

[2026-02-20] Pending Commit
- Fix CI hook-order failure in StorefrontPublic:
  - eliminate conditional hook execution path by shifting early returns below hook declarations.
  - add safe optional chaining for pre-load state.

[2026-02-20] Pending Commit
- Platform owner super-admin menu structure implemented with dedicated platform sections and routes.
- Added placeholder module pages for payments, billing, plugins, API, risk, config, and reports.
- Hid store-only menus for platform owner scope to avoid daily store operations in super-admin sidebar.

[2026-02-20] Pending Commit
- Merchant module fix:
  - backend `/api/merchants` now returns nested store list per merchant.
  - frontend merchant page now renders mapped stores under each merchant card.

[2026-02-20] Pending Commit
- Full platform-owner menu wiring completed:
  - Added platform owner module controller APIs for payments, billing, plugins, API governance, risk, reports, and platform config.
  - Replaced platform module shell UI with live API-driven module screens and save actions.

[2026-02-20] Pending Commit
- RBAC simplified for platform owner operations:
  - Added default user-type assignment endpoint.
  - Replaced complex CSV permission UI with simple default assignment actions for Platform Staff and Store Owner.

[2026-02-20] Pending Commit
- Platform RBAC UX overhaul:
  - Modernized user-role assignment UI.
  - Added current-role fetch on user click.
  - Added direct role update for both platform and store scopes.
- Backend added store-role get/update APIs for platform owner operations.

[2026-02-20] Pending Commit
- Resolved RBAC/admin `csrf_invalid` issue by bypassing CSRF validation for Bearer-token authenticated unsafe methods.

[2026-02-20] Pending Commit
- RBAC role badge fix:
  - Added store role data in `/platform/rbac/users` response.
  - Updated UI labels to show Store Role in Store Users tab.

[2026-02-20] Pending Commit
- Auto role-based menu fix on login:
  - Tenancy resolver fallback to first store membership when no store header exists.
  - Ensures immediate role permissions and sidebar rendering for store users.

[2026-02-20] Pending Commit
- Fix store owner login store-context issue:
  - Tenancy resolver fallback for invalid/stale store header membership.
  - Frontend active store auto-correction when stored store id is invalid.

[2026-02-20] Pending Commit
- Store-owner modules moved from mock/demo to live backend wiring:
  - Added store insights APIs for dashboard, analytics, and marketing.
  - Rebuilt frontend dashboard/analytics/marketing pages against live API responses.

[2026-02-20] Pending Commit
- Fixed store-user login context failure by adding missing `store.settings.read` permissions to role templates.

[2026-02-20] Pending Commit
- Store context hardening:
  - Updated `/api/stores` list authorization path to membership-scoped listing so store users can always resolve active store context.
  - Prevents false `Store is not selected` for valid store-owner/store-staff accounts.
- File:
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Controllers/StoresController.cs
- Commit: 6f1c503 (pushed to origin/main)

[2026-02-20] Pending Commit
- Auth/store binding hardening:
  - Token response now includes `default_store_id` for login/refresh/webauthn login.
  - Frontend login persists store id and sets `X-Store-Id` immediately.
  - Logout clears persisted store context/header to avoid stale store carryover.
  - Invite/onboarding completion flows also set `X-Store-Id` immediately.
- Files:
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Models/User.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Program.cs
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/pages/auth/Login.js
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/lib/session.js
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/components/layouts/DashboardLayout.js
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/pages/auth/Onboarding.js
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/pages/auth/AcceptInvite.js
- Commit: 8bc388d (pushed to origin/main)

[2026-02-20] Pending Commit
- Theme activate/preview fix:
  - Added explicit Activate button per theme card + clearer activation error feedback.
  - Wired top Preview button to active theme preview.
  - Preview calls now include `storeId` + `previewThemeId`.
  - Public storefront APIs now support `storeId` fallback lookup when subdomain is missing in preview flow.
  - Theme apply no longer increments/blocks on theme install usage counter per activation click.
- Files:
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/pages/admin/StoreBuilder.js
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/pages/storefront/StorefrontPublic.js
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Controllers/PublicStorefrontController.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Services/SubscriptionCapabilityService.cs
- Commit: cd79496 (pushed to origin/main)

[2026-02-20] Pending Commit
- Domain + SSL platform pass:
  - Cloudflare custom-domain DNS automation (CNAME + verification TXT upsert/check).
  - Custom-domain SSL marketplace purchase gate + purchase endpoint.
  - Domain verify flow now checks Cloudflare DNS status and auto-issues SSL after purchase.
  - Store/onboarding auto-subdomain generation + onboarding subdomain DNS provisioning.
  - Tenancy resolver now supports verified custom-domain host mapping.
  - Domains UI updated with buy-ssl flow and DNS fallback hints.
- Files:
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Services/CloudflareDnsService.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Controllers/DomainSslController.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Models/Storefront.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Data/AppDbContext.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Program.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Controllers/StoresController.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Services/TenancyContext.cs
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/pages/admin/DomainsSsl.js
- Commit: 435c3a9 (pushed to origin/main)

[2026-02-20] Pending Commit
- Platform owner domain control implementation:
  - New platform owner domain module with global subdomain/custom-domain visibility.
  - New domain config API/UI for Cloudflare + Let's Encrypt runtime values.
  - Cloudflare and SSL services now read platform-saved config keys (DB) with env fallback.
  - Added dedicated platform menu route `/admin/platform-domains`.
  - Clarified subdomain-taken logic (normalized + numeric suffix).
- Files:
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Controllers/PlatformOwnerModulesController.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Services/CloudflareDnsService.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Services/SslService.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Controllers/DomainSslController.cs
  - /Volumes/Rakesh/RBproject/sitesellr/backend-dotnet/Program.cs
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/pages/admin/PlatformModule.js
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/components/layouts/DashboardLayout.js
  - /Volumes/Rakesh/RBproject/sitesellr/frontend/src/App.js
- Commit: 8ffce98 (pushed to origin/main)

[Pending push] 2026-02-21 - Advanced Domain/SSL automation hardening
Files:
- backend-dotnet/Controllers/PlatformOwnerModulesController.cs
- backend-dotnet/Services/CloudflareDnsService.cs
- backend-dotnet/Services/SslService.cs
- frontend/src/pages/admin/PlatformModule.js
- Requirestatus.txt
- github_commit.txt
- masterrequirement.txt
Notes:
- Added Cloudflare token test + zone discovery APIs and UI actions.
- Added ACME config fields and SSL provider health-check endpoint.
- Added runtime executable verification for SSL issuer command.

[Pending push] 2026-02-21 - platform modules load fix + Cloudflare OAuth connect
Files:
- backend-dotnet/Controllers/PlatformOwnerModulesController.cs
- frontend/src/pages/admin/PlatformModule.js
- Requirestatus.txt
- github_commit.txt
- masterrequirement.txt
Notes:
- Replaced non-translatable EF filters with ILike to fix module API load failures.
- Added Cloudflare OAuth-style connect start/callback and persisted OAuth config fields.

[Pending push] 2026-02-21 - OAuth auto defaults and SSL pricing visibility
Files:
- backend-dotnet/Controllers/PlatformOwnerModulesController.cs
- backend-dotnet/Controllers/DomainSslController.cs
- frontend/src/pages/admin/PlatformModule.js
- frontend/src/pages/admin/DomainsSsl.js
- Requirestatus.txt
- github_commit.txt
- masterrequirement.txt
Notes:
- Auto default OAuth authorize/token URLs and auto-generate redirect URI when empty.
- Added configurable SSL price and exposed it in store domain APIs/UI.

[Pending push] 2026-02-21 - strict subdomain policy and wildcard CORS
Files:
- backend-dotnet/Services/SubdomainPolicy.cs
- backend-dotnet/Program.cs
- backend-dotnet/Controllers/StoresController.cs
- Requirestatus.txt
- github_commit.txt
- masterrequirement.txt
Notes:
- Enforced reserved-word/format validation for store subdomains.
- Added wildcard-origin CORS matcher for production subdomain storefront/admin setups.

[Pending push] 2026-02-21 - origin TLS lifecycle automation
Files:
- backend-dotnet/Services/OriginTlsService.cs
- backend-dotnet/Controllers/PlatformOwnerModulesController.cs
- backend-dotnet/Program.cs
- frontend/src/pages/admin/PlatformModule.js
- Requirestatus.txt
- github_commit.txt
- masterrequirement.txt
Notes:
- Added origin TLS status + issue/renew APIs and platform UI controls.
- Added DB/env fallback settings for origin cert paths and issuer command.

[Pending push] 2026-02-21 - product media section enhancements
Files:
- frontend/src/pages/admin/Products.js
- Requirestatus.txt
- github_commit.txt
- masterrequirement.txt
Notes:
- Added multi-image media support, drag-reorder controls, optional video URL, and media preview UI for products.

[Pending push] 2026-02-21 - product media upload pipeline and category wiring
Files:
- backend-dotnet/Services/MediaAssetService.cs
- backend-dotnet/Controllers/ProductsController.cs
- backend-dotnet/Controllers/StorefrontController.cs
- backend-dotnet/Program.cs
- backend-dotnet/backend-dotnet.csproj
- frontend/src/pages/admin/Products.js
- Requirestatus.txt
- github_commit.txt
- masterrequirement.txt
Notes:
- Added direct media upload and URL-fetch optimization endpoints for products.
- Added automatic single-size image normalization (1200x1200 webp).
- Wired categories list/filter/select and quick create in product UI.

[Pending push] 2026-02-21 - enforce automatic product image normalization
Files:
- frontend/src/pages/admin/Products.js
- backend-dotnet/Controllers/ProductsController.cs
- Requirestatus.txt
- github_commit.txt
- masterrequirement.txt
Notes:
- Enforced automatic normalization of external image URLs at frontend save flow and backend create/update flow.

[Pending push] 2026-02-21 - runtime CORS whitelist controls for platform and store owner
Files:
- backend-dotnet/Services/CorsOriginRegistry.cs
- backend-dotnet/Program.cs
- backend-dotnet/Controllers/PlatformOwnerModulesController.cs
- backend-dotnet/Controllers/StoresController.cs
- frontend/src/pages/admin/PlatformModule.js
- frontend/src/pages/admin/Settings.js
- Requirestatus.txt
- github_commit.txt
- masterrequirement.txt
Notes:
- Added dynamic CORS runtime allowlist and UI/APIs for platform and store-level origin whitelists.

[Pending push] 2026-02-21 - build fix for CS0266 and ImageSharp bump
Files:
- backend-dotnet/Controllers/ProductsController.cs
- backend-dotnet/backend-dotnet.csproj
- Requirestatus.txt
- github_commit.txt
- masterrequirement.txt
Notes:
- Fixed ICollection assignment type issue in product media normalization.
- Bumped ImageSharp package version to 3.1.8.

[Pending push] 2026-02-21 - fix store selection and CORS save flow
Files:
- frontend/src/pages/admin/Settings.js
- frontend/src/hooks/useActiveStore.js
- backend-dotnet/Controllers/AuthAccessController.cs
- Requirestatus.txt
- github_commit.txt
- masterrequirement.txt
Notes:
- Fixed "Select a store first" by binding save flow to active store context and login tenancy store fallback.

[Pending push] 2026-02-21 - fix store update validation (merchant required)
Files:
- backend-dotnet/Controllers/StoresController.cs
- Requirestatus.txt
- github_commit.txt
Notes:
- Introduced StoreUpsertRequest DTO for create/update.
- Eliminated entity navigation validation causing 400 on missing Merchant payload.

[Pending push] 2026-02-21 - guard store save against null/blank name
Files:
- backend-dotnet/Controllers/StoresController.cs
- Requirestatus.txt
- github_commit.txt
Notes:
- Added `name_required` validation for create/update to prevent null trim exception.

[Pending push] 2026-02-21 - make store save resilient against Cloudflare DNS failures
Files:
- backend-dotnet/Controllers/StoresController.cs
- Requirestatus.txt
- github_commit.txt
Notes:
- Added controller-level try/catch for store create/update.
- Made Cloudflare DNS provisioning best-effort (warning only), not a blocking save failure.

[Pending push] 2026-02-21 - add default render frontend origin to CORS allowlist
Files:
- backend-dotnet/Services/CorsOriginRegistry.cs
- Requirestatus.txt
- github_commit.txt
Notes:
- Added default allowlist origin for `https://sitesellr-web.onrender.com`.
- Normalized origins by trimming trailing slash.

[Pending push] 2026-02-21 - make product media URL optimization non-blocking
Files:
- backend-dotnet/Controllers/ProductsController.cs
- frontend/src/pages/admin/Products.js
- Requirestatus.txt
- github_commit.txt
Notes:
- Product save now supports upload or URL media without hard failure when remote URL is temporarily unreachable.
- Video URL remains optional and saved in same media set.

[Pending push] 2026-02-21 - fix product create 500 from nested entity key conflicts
Files:
- backend-dotnet/Controllers/ProductsController.cs
- Requirestatus.txt
- github_commit.txt
Notes:
- Product create now builds fresh entity graph and assigns IDs for child rows.
- Added catch/log path returning `product_create_failed` for easier production diagnosis.

[Pending push] 2026-02-21 - improve login error clarity by backend status/code mapping
Files:
- frontend/src/pages/auth/Login.js
- Requirestatus.txt
- github_commit.txt
Notes:
- Added status/code-to-message mapping for auth failures.

[Pending push] 2026-02-21 - add global exception handler with CORS-safe error responses
Files:
- backend-dotnet/Program.cs
- Requirestatus.txt
- github_commit.txt
Notes:
- Unhandled exceptions now return `server_error` JSON and include CORS headers for allowed origins.

[Pending push] 2026-02-21 - fix missing authentication scheme for authorize endpoints
Files:
- backend-dotnet/Security/OpaqueTokenAuthenticationHandler.cs
- backend-dotnet/Program.cs
- Requirestatus.txt
- github_commit.txt
Notes:
- Added bearer authentication pipeline for opaque tokens.
- Prevents 500 from missing default challenge/authenticate scheme.

[Pending push] 2026-02-21 - fix false 403 from policy/permission naming mismatch
Files:
- backend-dotnet/Security/Rbac.cs
- backend-dotnet/Security/PermissionCatalog.cs
- Requirestatus.txt
- github_commit.txt
Notes:
- Added compatibility mapping for legacy write policies to granular permissions.
- Added compatibility permissions to default store role templates.

[Pending push] 2026-02-21 - harden stores API with DTO responses and list error handling
Files:
- backend-dotnet/Controllers/StoresController.cs
- Requirestatus.txt
- github_commit.txt
Notes:
- Added StoreResponse mapping for list/get/create/update.
- Added explicit list error handling (`stores_list_failed`).

[Pending push] 2026-02-21 - harden tenancy resolver to avoid global 500 on store/domain lookup errors
Files:
- backend-dotnet/Services/TenancyContext.cs
- Requirestatus.txt
- github_commit.txt
Notes:
- Store/domain lookup exceptions no longer crash all API requests.

[Pending push] 2026-02-21 - remove entity-binding validation/cycle failures in category/product APIs
Files:
- backend-dotnet/Controllers/CategoriesController.cs
- backend-dotnet/Controllers/ProductsController.cs
- Requirestatus.txt
- github_commit.txt
Notes:
- Switched to request/response DTO contracts for category/product APIs.
- Eliminated navigation-property validation and object cycle serialization issues.

[Pending push] 2026-02-21 - upgrade ImageSharp to reduce audit warning exposure
Files:
- backend-dotnet/backend-dotnet.csproj
- Requirestatus.txt
- github_commit.txt
Notes:
- Bumped ImageSharp to 3.1.10.

[Pending push] 2026-02-21 - fix CS0019 in ProductsController DTO mapping
Files:
- backend-dotnet/Controllers/ProductsController.cs
- Requirestatus.txt
- github_commit.txt
Notes:
- Removed incompatible `?? Array.Empty<ProductVariantUpsertRequest>()` expression.

[Pending push] 2026-02-21 - bump ImageSharp to 3.1.11
Files:
- backend-dotnet/backend-dotnet.csproj
- Requirestatus.txt
- github_commit.txt
Notes:
- Updated ImageSharp package version to 3.1.11.

[Pending push] 2026-02-21 - harden category endpoints and return flat DTO responses
Files:
- backend-dotnet/Controllers/CategoriesController.cs
- Requirestatus.txt
- github_commit.txt
Notes:
- Added exception-safe category list/create handlers.
- Response contract flattened to DTO.

[Pending push] 2026-02-21 - fix product thumbnail/category mapping and order list DTO serialization
Files:
- backend-dotnet/Controllers/ProductsController.cs
- backend-dotnet/Controllers/OrdersController.cs
- frontend/src/lib/mappers.js
- Requirestatus.txt
- github_commit.txt
Notes:
- Added product category name in API response.
- Thumbnail selection now ignores video URLs.
- Orders endpoints now use DTO responses to avoid cycle-related runtime failures.

[Pending push] 2026-02-21 - add India state catalog and modernize storefront checkout flow
Files:
- backend-dotnet/Services/IndiaStateCatalog.cs
- backend-dotnet/Controllers/MetaController.cs
- backend-dotnet/Controllers/PublicStorefrontController.cs
- frontend/src/pages/storefront/StorefrontPublic.js
- Requirestatus.txt
- github_commit.txt
Notes:
- Added global India states endpoint and checkout address/state validation.
- Upgraded storefront checkout UI and payload for production-ready India address capture.
